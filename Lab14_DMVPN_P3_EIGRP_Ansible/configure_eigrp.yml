---
- name: Configure EIGRP on MGRE Tunnel between HQ, YGN and MDY
  hosts: routers
  gather_facts: no
  connection: network_cli

  vars:
    eigrp_config:
      HQ:
        as_number: 100
        network_statements:
          - network 10.10.10.10 0.0.0.0
          - network 192.168.0.1 0.0.0.0
        tunnel_interface: tunnel0
        lan_interface: GigabitEthernet0/2
        is_hub: true
        
      YGN:
        as_number: 100
        network_statements:
          - network 10.10.10.11 0.0.0.0
          - network 192.168.1.1 0.0.0.0
        tunnel_interface: tunnel0
        lan_interface: GigabitEthernet0/2
        is_hub: false
        
      MDY:
        as_number: 100
        network_statements:
          - network 10.10.10.12 0.0.0.0
          - network 192.168.2.1 0.0.0.0
        tunnel_interface: tunnel0
        lan_interface: GigabitEthernet0/2
        is_hub: false

  tasks:
    - name: Configure EIGRP on routers
      ios_config:
        parents: "router eigrp {{ eigrp_config[inventory_hostname].as_number }}"
        lines:
          - "{{ eigrp_config[inventory_hostname].network_statements[0] }}"
          - "{{ eigrp_config[inventory_hostname].network_statements[1] }}"
          - "no auto-summary"
          - "passive-interface default"
          - "no passive-interface {{ eigrp_config[inventory_hostname].tunnel_interface }}"

    - name: Configure EIGRP on Tunnel interface
      ios_config:
        parents: "interface {{ eigrp_config[inventory_hostname].tunnel_interface }}"
        lines:
          - "ip bandwidth-percent eigrp {{ eigrp_config[inventory_hostname].as_number }} 50"
          - "ip hello-interval eigrp {{ eigrp_config[inventory_hostname].as_number }} 10"
          - "ip hold-time eigrp {{ eigrp_config[inventory_hostname].as_number }} 30"

    - name: Configure EIGRP stub for spokes
      ios_config:
        parents: "router eigrp {{ eigrp_config[inventory_hostname].as_number }}"
        lines:
          - "eigrp stub connected summary"
      when: eigrp_config[inventory_hostname].is_hub == false

    - name: Verify EIGRP configuration
      ios_command:
        commands:
          - show ip protocols
          - show ip eigrp neighbors
          - show ip eigrp topology
          - show ip route eigrp
      register: eigrp_output

    - name: Display EIGRP status
      debug:
        var: eigrp_output.stdout_lines