---
- name: Complete EIGRP Configuration for Cisco Routers
  hosts: routers
  gather_facts: no  
  
  tasks:
    # Task 1: Validate EIGRP configuration variables
    - name: Validate EIGRP configuration variables
      assert:
        that:
          - eigrp_autonomous_system is defined
          - eigrp_md5_key is defined
          - eigrp_key_id is defined
        fail_msg: "Missing required EIGRP variables"

    # Task 2: Configure IP addresses on interfaces
    - name: Configure IP addresses on interfaces
      cisco.ios.ios_l3_interfaces:
        config:
          - name: "{{ item.interface }}"
            ipv4:
              - address: "{{ item.ip_address }}/{{ item.prefix }}"
      loop: "{{ eigrp_interfaces }}"
      when: eigrp_interfaces is defined

    # Task 3: No shutdown on GigabitEthernet interfaces
    - name: Enable physical interfaces
      cisco.ios.ios_config:
        lines:
          - "no shutdown"
        parents: "interface {{ item.interface }}"
      loop: "{{ eigrp_interfaces | selectattr('interface', 'match', '^GigabitEthernet') | list }}"
      when: eigrp_interfaces is defined

    